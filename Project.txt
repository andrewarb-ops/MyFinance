MyFinance
Личный финансовый трекер для учёта счетов, категорий и транзакций.
Backend: FastAPI + SQLAlchemy + Alembic
Frontend: React + Vite + TypeScript + Tailwind CSS

--------------------
Возможности
--------------------
Управление счетами:
- банковские карты, наличные, брокерские и любые другие типы;
- хранение маски номера карты (формат **** 1234), полный номер карты не сохраняется.

Категории доходов и расходов:
- иерархия категорий (родитель → дочерние);
- разделение по типам: доход / расход.

Транзакции:
- операции дохода, расхода и перевода между счетами;
- сумма в минимальных единицах (копейки), валюта, дата/время;
- привязка к категории, текстовое описание;
- группировка переводов по общему идентификатору.

Дашборд:
- агрегированные показатели по выбранному периоду (день, неделя, месяц, квартал, год);
- график динамики доходов и расходов;
- распределение расходов по категориям (круговая диаграмма и TOP категорий).

UI:
- современный светлый интерфейс;
- страница «Мои счета» с карточками (значок МИР/₽, название, маска номера, валюта, статус);
- модальное окно создания счёта с выбором типа и валюты;
- отдельные страницы для категорий и транзакций;
- дашборд с агрегированными показателями, графиками и распределением расходов по категориям.

API:
- REST‑эндпоинты для счетов, категорий и транзакций;
- дашборд‑эндпоинты для агрегированных показателей:
  - GET /dashboard/summary — сводка по периоду (доходы, расходы, чистый поток, общий баланс активных счетов);
  - GET /dashboard/trends — точки для графика доходов и расходов по дням или месяцам;
  - GET /dashboard/categories — суммы расходов по категориям и доля каждой категории в общих расходах;
- автогенерация Swagger‑документации FastAPI по адресу /docs.

--------------------
Стек технологий
--------------------
Backend:
- Python
- FastAPI
- SQLAlchemy (ORM)
- Alembic (миграции)
- SQLite (по умолчанию)

Frontend:
- React
- Vite
- TypeScript
- Tailwind CSS

Прочее:
- monorepo: backend и frontend в одном репозитории;
- Pydantic v2 для схем API;
- простой HTML‑шаблон для просмотра содержимого БД.

--------------------
Схема БД
--------------------
TABLE accounts
  COLUMN id                 INTEGER      nullable=False  default=None
  COLUMN name               VARCHAR      nullable=False  default=None
  COLUMN type               VARCHAR      nullable=False  default=None
  COLUMN currency           VARCHAR(3)   nullable=False  default=None
  COLUMN is_active          BOOLEAN      nullable=False  default=None
  COLUMN created_at         DATETIME     nullable=False  default=CURRENT_TIMESTAMP
  COLUMN card_number        VARCHAR(32)  nullable=True   default=None

TABLE alembic_version
  COLUMN version_num        VARCHAR(32)  nullable=False  default=None

TABLE budgets
  COLUMN id                 INTEGER      nullable=False  default=None
  COLUMN category_id        INTEGER      nullable=False  default=None
  COLUMN period_start       DATE         nullable=False  default=None
  COLUMN period_end         DATE         nullable=False  default=None
  COLUMN amount_minor       INTEGER      nullable=False  default=None

TABLE categories
  COLUMN id                 INTEGER      nullable=False  default=None
  COLUMN name               VARCHAR      nullable=False  default=None
  COLUMN type               VARCHAR      nullable=False  default=None   -- "income" / "expense"
  COLUMN parent_id          INTEGER      nullable=True   default=None
  COLUMN is_active          BOOLEAN      nullable=False  default=None

TABLE transactions
  COLUMN id                 INTEGER      nullable=False  default=None
  COLUMN account_id         INTEGER      nullable=False  default=None
  COLUMN category_id        INTEGER      nullable=True   default=None
  COLUMN amount_minor       INTEGER      nullable=False  default=None
  COLUMN currency           VARCHAR(3)   nullable=False  default=None
  COLUMN dt                 DATETIME     nullable=False  default=None
  COLUMN description        TEXT         nullable=True   default=None
  COLUMN transfer_group_id  INTEGER      nullable=True   default=None
  COLUMN created_at         DATETIME     nullable=False  default=CURRENT_TIMESTAMP

--------------------
Структура проекта
--------------------
myFinance/
├── api
│   ├── __init__.py
│   ├── accounts.py
│   ├── categories.py
│   ├── schemas.py
│   ├── transactions.py
│   └── dashboard.py
├── db
│   ├── __init__.py
│   └── base.py
├── frontend
│   ├── public
│   │   └── vite.svg
│   ├── src
│   │   ├── api
│   │   │   ├── accounts.ts
│   │   │   └── client.ts
│   │   ├── assets
│   │   │   └── react.svg
│   │   ├── components
│   │   │   └── layout
│   │   │       └── MainLayout.tsx
│   │   ├── pages
│   │   │   ├── Accounts
│   │   │   │   ├── CreateAccountModal.tsx
│   │   │   │   ├── EditAccountModal.tsx
│   │   │   │   └── index.tsx
│   │   │   ├── Categories
│   │   │   │   └── index.tsx
│   │   │   ├── Dashboard
│   │   │   │   └── index.tsx
│   │   │   └── Transactions
│   │   │       └── index.tsx
│   │   ├── App.tsx
│   │   ├── index.css
│   │   └── main.tsx
│   ├── .gitignore
│   ├── eslint.config.js
│   ├── index.html
│   ├── package-lock.json
│   ├── package.json
│   ├── postcss.config.cjs
│   ├── README.md
│   ├── tailwind.config.cjs
│   ├── tsconfig.app.json
│   ├── tsconfig.json
│   ├── tsconfig.node.json
│   └── vite.config.ts
├── migrations
│   ├── versions
│   │   ├── 864daeea00b5_add_card_number_to_accounts.py
│   │   └── a26138cee6f3_init_schema.py
│   ├── env.py
│   ├── README
│   └── script.py.mako
├── models
│   ├── __init__.py
│   ├── account.py
│   ├── budget.py
│   ├── category.py
│   └── transaction.py
├── services
│   ├── accounts.py
│   ├── categories.py
│   ├── transactions.py
│   └── dashboard.py
├── templates
│   └── db_view.html
├── .gitignore
├── alembic.ini
├── check_category_sums.py
├── clear_db.py
├── main.py
├── myfinance.db
├── PrApi.txt
├── print_schema.py
├── Project.txt
├── PrService.txt
└── tree.py

api/ – HTTP‑слой FastAPI.

__init__.py – пакетный файл, обычно пустой.

accounts.py – эндпоинты /accounts (CRUD по счетам, GET/POST/PATCH/DELETE).

categories.py – эндпоинты /categories (категории доходов/расходов).

transactions.py – эндпоинты /transactions (доход, расход, переводы).

dashboard.py – эндпоинты /dashboard (summary/trends/categories для дашборда).

schemas.py – Pydantic‑схемы: AccountCreate/Update/Out, CategoryCreate/Out, TransactionCreate/Out,
а также DashboardSummaryOut, DashboardTrendsOut, DashboardCategoriesOut для ответов дашборда.

db/ – инфраструктура БД.

__init__.py – экспорт session_scope/SessionLocal.

base.py – engine, SessionLocal, Base для SQLAlchemy.

models/ – ORM‑модели.

__init__.py – собирает модели в пакет.

account.py – модель счёта (accounts), поля name, type, currency, is_active, card_number, created_at.

budget.py – бюджеты по категориям и периодам.

category.py – категории доходов/расходов (type, parent_id, is_active).

transaction.py – транзакции (account_id, category_id, amount_minor, currency, dt, description, transfer_group_id, created_at).

services/ – бизнес‑логика поверх моделей.

accounts.py – операции со счетами: DTO, маскирование номера карты, create/list/get/deactivate,
update_account и delete_account.

categories.py – CRUD‑логика для категорий с валидацией типа income/expense.

transactions.py – добавление доходов, расходов и переводов, расчёт баланса.

dashboard.py – агрегирующие функции для дашборда (итоги по периодам, тренды, суммы по категориям).

migrations/ – Alembic.

versions/ – скрипты миграций (init_schema, добавление card_number).

env.py, script.py.mako, README – стандартная обвязка Alembic.

templates/

db_view.html – HTML‑страница для просмотра содержимого БД (debug‑view).

Прочие backend‑файлы:

main.py – создание FastAPI‑приложения, подключение роутеров (включая dashboard), CORS, маршрут /db_view.

myfinance.db – SQLite‑файл БД.

alembic.ini – конфиг Alembic.

check_category_sums.py, clear_db.py, print_schema.py, tree.py – вспомогательные скрипты для отладки и обслуживания.

PrApi.txt, PrService.txt, Project.txt – текстовая документация по API, сервисам и проекту в целом.

Frontend
frontend/public/ – статические файлы (иконки, vite.svg).

frontend/src/api/ – тонкий клиент к backend.

client.ts – универсальные функции apiGet, apiPost, apiPatch, apiDelete с fetch.

accounts.ts – интерфейсы Account, AccountCreate, AccountUpdate и функции getAccounts, createAccount, updateAccount, deleteAccount.

(позже будет добавлен dashboard.ts для обращения к эндпоинтам /dashboard).

frontend/src/assets/ – статичные ресурсы (например, react.svg).

frontend/src/components/layout/

MainLayout.tsx – общий лейаут приложения (шапка, боковое меню и т.п.).

frontend/src/pages/ – страницы роутера.

Accounts/
CreateAccountModal.tsx – модалка для создания нового счёта.
EditAccountModal.tsx – модалка редактирования счёта (включая флаг активности).
index.tsx – страница «Мои счета»: запрос списка, рендер карточек, открытие модалок, удаление.

Categories/index.tsx – страница категорий (отображение/редактирование категорий).

Dashboard/index.tsx – дашборд (агрегированные показатели, графики и распределение расходов по категориям).

Transactions/index.tsx – список транзакций.

Корневые файлы фронта:

App.tsx – корневой компонент с роутингом.

main.tsx – входная точка React (mount в DOM).

index.css – глобальные стили, Tailwind base.

Конфиги: vite.config.ts, tsconfig*.json, tailwind.config.cjs, postcss.config.cjs, eslint.config.js, package.json, package-lock.json.

index.html – HTML‑шаблон Vite.

Транзакции и редактирование:
- Поддержка трёх типов операций: income / expense / transfer (перевод между счетами).
- Редактирование транзакций с изменением категории, описания и суммы (в обеих записях перевода).
- Сумма хранится в минимальных единицах (amount_minor), знак определяется типом операции.

Баланс счетов:
- Сервисный метод get_account_balance(account_id, currency=None) в services/transactions.py
  считает баланс по всем транзакциям счёта (с учётом знака доходов/расходов и переводов).
- API:
  - GET /accounts/{account_id}/balance — текущий баланс конкретного счёта
    (возвращает account_id, balance_minor, currency).
  - GET /accounts/summary/balance — суммарный баланс по активным счетам в выбранной валюте.

Фронтенд – страницы счётов:
- Обновлённый api/accounts.ts:
  - добавлен тип AccountBalance и функция getAccountBalance(id).
- Страница "Мои счета" (frontend/src/pages/Accounts/index.tsx):
  - после загрузки списка счетов запрашивает балансы по каждому счёту;
  - в карточке счёта отображает актуальный баланс крупным зелёным курсивным шрифтом;
  - логика создания, редактирования и удаления счётов сохранена.

Фронтенд – форма транзакций:
- Обновлён AddTransactionModal:
  - единая форма для дохода, расхода и перевода между счетами;
  - быстрые категории с иконками (emoji) и полный выпадающий список категорий;
  - в режиме редактирования подтягивает существующие значения и отправляет PATCH
    с обновлённой категорией, описанием и суммой (amount_minor).

Фронтенд – дашборд:

- Добавлен api/dashboard.ts с обращением к backend‑эндпоинтам:
  - GET /dashboard/summary — getDashboardSummary(period, baseDate, currency)
  - GET /dashboard/trends — getDashboardTrends(period, baseDate, currency)
  - GET /dashboard/categories — getDashboardCategories(period, baseDate, limit, currency)
- Страница Dashboard (frontend/src/pages/Dashboard/index.tsx):
  - выбор периода (day/week/month/quarter/year) и базовой даты;
  - загрузка сводки, трендов и категорий одним запросом (Promise.all);
  - KPI‑карточки (чистый поток, доходы, расходы, баланс счетов) с форматированием сумм в рублях.

Фронтенд – компоненты дашборда:

- KpiCard (frontend/src/components/dashboard/KpiCard.tsx)
  - переиспользуемая карточка для верхних метрик (заголовок, значение, акценты для доходов/расходов).
- TopCategoriesTable (frontend/src/components/dashboard/TopCategoriesTable.tsx)
  - таблица TOP категорий расходов: категория, сумма, доля в процентах;
  - отображается отдельным блоком под графиками.
- TrendChart (frontend/src/components/dashboard/TrendChart.tsx)
  - столбчатая диаграмма расходов по дням/месяцам на базе Recharts;
  - значения приводятся из копеек в рубли, тултип показывает сумму вида «1 234,56 ₽».
- DonutChart (frontend/src/components/dashboard/DonutChart.tsx)
  - круговая диаграмма (donut) распределения расходов по категориям;
  - суммы категорий приводятся к рублям, легенда с названиями категорий и цветами;
  - в центре бублика отображается общая сумма расходов за выбранный период красным жирным текстом.

Итоговый дашборд:

- верхняя полоса KPI‑карточек по периоду;
- средняя строка: слева столбчатый график расходов, справа бублик по категориям;
- нижняя часть: подробная таблица категорий с абсолютными значениями и долями, синхронизированная с диаграммой.
